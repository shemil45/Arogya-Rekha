<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Provider Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../css/main.css" />
    <link rel="stylesheet" href="../../css/mobile.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background:#1B4F72;">
      <div class="container">
        <a class="navbar-brand" href="#">Provider Portal</a>
        <div class="ms-auto d-flex gap-2">
          <a class="btn btn-outline-light btn-sm" href="./scanner.html"><i class="bi bi-qr-code-scan"></i> Scan</a>
          <a class="btn btn-warning btn-sm" href="../../index.html">Logout</a>
        </div>
      </div>
    </nav>

    <div class="container py-4">
      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <div class="card card-elevated p-3">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <div class="small text-muted">Role</div>
                <div class="fw-bold" id="roleText">—</div>
              </div>
              <a href="./scanner.html" class="btn btn-success">Open Scanner</a>
            </div>
          </div>
          <div class="card card-elevated p-3 mt-3">
            <div class="small text-muted">Recent Patients</div>
            <ul id="recentList" class="list-group list-group-flush"></ul>
          </div>
        </div>
        <div class="col-12 col-lg-8">
          <div class="card card-elevated p-3">
            <div class="d-flex align-items-center justify-content-between">
              <h2 class="h5 m-0">Search Patient</h2>
            </div>
            <div class="input-group mt-2">
              <input id="searchId" type="text" class="form-control" placeholder="Enter Health ID (e.g. MW123456)" />
              <button id="searchBtn" class="btn btn-primary">Open</button>
            </div>
            <div class="small text-muted mt-2">Tip: Use the scanner for faster access</div>
          </div>
        </div>
      </div>
    </div>

    <div class="app-toast"></div>

    <script src="../../js/data.js"></script>
    <script src="../../js/main.js"></script>
    <script>
      document.getElementById('roleText').textContent = localStorage.getItem(App.STORAGE_KEYS.providerRole) || '—';
      const recent = (App.getWorkers() || []).slice(0, 5);
      const list = document.getElementById('recentList');
      if (recent.length === 0) {
        list.innerHTML = '<li class="list-group-item">No recent patients</li>';
      } else {
        recent.forEach(w => {
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = `<span>${w.name} <span class="text-muted small">(${w.healthId})</span></span> <a class="btn btn-sm btn-outline-primary" href="./patient-record.html?id=${w.healthId}">Open</a>`;
          list.appendChild(li);
        });
      }

      document.getElementById('searchBtn').addEventListener('click', () => {
        const id = document.getElementById('searchId').value.trim();
        if (!id) { App.showToast('Enter a Health ID', 'error'); return; }
        const w = App.findWorkerById(id);
        if (!w) { App.showToast('No patient found', 'error'); return; }
        window.location.href = `./patient-record.html?id=${id}`;
      });
    </script>
  </body>
  </html>

